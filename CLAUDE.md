# CLAUDE.md - ChatFold Project Guidance

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

> **ğŸ“ å®Œæ•´æ–‡æ¡£ä½“ç³»**: å‚è€ƒ [docs/README.md](./docs/README.md) æŸ¥çœ‹å®Œæ•´æ–‡æ¡£å¯¼èˆª
> **ğŸ“ å¿«é€Ÿå…¥é—¨**: æ–°æˆå‘˜è¯·å…ˆé˜…è¯»æœ¬æ–‡æ¡£çš„é¡¹ç›®æ¦‚è§ˆå’Œå¼€å‘å‘½ä»¤éƒ¨åˆ†

## 1. äº§å“æ¦‚è§ˆ

ChatFold æ˜¯ä¸€ä¸ª ChatGPT é£æ ¼çš„è›‹ç™½è´¨æŠ˜å å·¥ä½œå°ï¼Œæ”¯æŒå®æ—¶æµå¼æŠ˜å è¿›åº¦å’Œ 3D ç»“æ„å¯è§†åŒ–ã€‚

### æ ¸å¿ƒåŠŸèƒ½

**è¾“å…¥**:

- FASTA æ ¼å¼è›‹ç™½è´¨åºåˆ—
- PDB ç»“æ„æ–‡ä»¶ä¸Šä¼ 
- è‡ªç„¶è¯­è¨€å¯¹è¯æŒ‡ä»¤

**è¾“å‡º**:

- 3D è›‹ç™½è´¨ç»“æ„å¯è§†åŒ–ï¼ˆMol\*ï¼‰
- æŠ˜å è¿›åº¦å®æ—¶å±•ç¤ºï¼ˆSSE æµå¼ï¼‰
- ç»“æ„è´¨é‡è¯„ä¼°æŒ‡æ ‡ï¼ˆpLDDT, PAEï¼‰
- å¯ä¸‹è½½çš„ PDB ç»“æ„æ–‡ä»¶

## 2. é¡¹ç›®ç»“æ„

```text
ChatFold-MVP/
â”œâ”€â”€ web/                 # Next.js å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/         # App Router é¡µé¢
â”‚   â”‚   â”œâ”€â”€ components/  # React ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ hooks/       # è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â””â”€â”€ lib/         # å·¥å…·å‡½æ•°å’ŒçŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â””â”€â”€ images/      # Logo ç­‰é™æ€å›¾ç‰‡ (Git LFS)
â”‚   â””â”€â”€ tests/
â”‚       â””â”€â”€ fixtures/    # æµ‹è¯•æ•°æ® (FASTA, PDB)
â”‚
â”œâ”€â”€ backend/             # FastAPI åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ routers/     # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ services/    # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ models/      # æ•°æ®æ¨¡å‹
â”‚   â”‚   â””â”€â”€ utils/       # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ requirements.txt
â”‚
â”œâ”€â”€ docs/                # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ developer/       # å¼€å‘è€…æ–‡æ¡£
â”‚   â”œâ”€â”€ workflow/        # å·¥ä½œæµç¨‹æ–‡æ¡£
â”‚   â”œâ”€â”€ features/        # åŠŸèƒ½å®ç°æ–‡æ¡£
â”‚   â””â”€â”€ standards/       # é€šç”¨å‡†åˆ™
â”‚
â””â”€â”€ molstar/             # Mol* æœ¬åœ°é…ç½®
```

## 3. æŠ€æœ¯æ ˆ

### å‰ç«¯

- **æ¡†æ¶**: Next.js 14+ / React 18 / TypeScript
- **çŠ¶æ€ç®¡ç†**: Zustand
- **UI ç»„ä»¶**: shadcn/ui (Radix UI)
- **æ ·å¼**: TailwindCSS
- **3D å¯è§†åŒ–**: Mol\* 4.5.0
- **æµ‹è¯•**: Vitest + Playwright

### åç«¯

- **æ¡†æ¶**: Python 3.10+ / FastAPI
- **æ•°æ®æ¨¡å‹**: Pydantic
- **å¼‚æ­¥**: asyncio + httpx

### å¼€å‘å·¥å…·

- **ä»£ç æ£€æŸ¥**: ESLint (å‰ç«¯) / ruff (åç«¯)
- **æµ‹è¯•**: Vitest (å•å…ƒ) / Playwright (E2E) / pytest (åç«¯)

## 4. å¿«é€Ÿå¼€å‘å‘½ä»¤

### å‰ç«¯å¼€å‘

```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd web

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆç«¯å£ 3000ï¼‰
npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# è¿è¡Œæµ‹è¯•
npm run test
npm run test:ui
```

### åç«¯å¼€å‘

```bash
# è¿›å…¥åç«¯ç›®å½•
cd backend

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆç«¯å£ 8000ï¼‰
uvicorn app.main:app --reload --port 8000
```

## 5. ç³»ç»Ÿæ¶æ„

```
  å‰ç«¯ (Next.js)                åç«¯ (FastAPI)
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Web UI      â”‚â—„â”€â”€â”€â”€HTTPâ”€â”€â”€â”€â”€â”¤  API Endpoints           â”‚
  â”‚  Port: 3000  â”‚              â”‚  Port: 8000              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                â”‚
         â”‚                                â”‚
         â–¼                                â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Mol* 3D     â”‚              â”‚  SSE Streaming           â”‚
  â”‚  Viewer      â”‚              â”‚  Mock Folding Pipeline   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®ç»„ä»¶

- **ä¸‰æ å¸ƒå±€** (`web/src/components/LayoutShell.tsx`)
  - å·¦ä¾§è¾¹æ : æ–‡ä»¶ç®¡ç†ã€å¯¹è¯åˆ—è¡¨
  - ä¸­å¤®ç”»å¸ƒ: Mol\* 3D ç»“æ„æŸ¥çœ‹å™¨
  - å³ä¾§æ§åˆ¶å°: æ­¥éª¤æ—¶é—´çº¿ã€èŠå¤©ã€å›¾è¡¨

- **çŠ¶æ€ç®¡ç†** (`web/src/lib/store.ts`)
  - Zustand å…¨å±€çŠ¶æ€ï¼Œæ”¯æŒæŒä¹…åŒ–

- **Mol\* é›†æˆ** (`web/src/components/MolstarViewer.tsx`)
  - åŠ¨æ€å¯¼å…¥é¿å… SSR é—®é¢˜
  - æ”¯æŒç»“æ„åŠ è½½ã€ç¼©ç•¥å›¾ç”Ÿæˆ

- **SSE æµå¼** (`backend/app/routers/tasks.py`)
  - å®æ—¶æ¨é€æŠ˜å è¿›åº¦äº‹ä»¶

### API ç«¯ç‚¹

| ç«¯ç‚¹                     | æ–¹æ³•     | è¯´æ˜           |
| ------------------------ | -------- | -------------- |
| `/api/conversations`     | POST/GET | åˆ›å»º/åˆ—è¡¨å¯¹è¯  |
| `/api/tasks`             | POST/GET | åˆ›å»º/åˆ—è¡¨ä»»åŠ¡  |
| `/api/tasks/{id}/stream` | GET      | SSE æŠ˜å è¿›åº¦æµ |
| `/api/structures/{id}`   | GET      | ä¸‹è½½ PDB æ–‡ä»¶  |

## 6. å¼€å‘è§„èŒƒ

### Git Commit Message è§„èŒƒ

**æ ¼å¼**: å¤šè¡Œæ ¼å¼ï¼ˆé¦–è¡Œ + è¯¦ç»†è¯´æ˜ï¼‰

```text
type: subject

Changes:
- å…·ä½“ä¿®æ”¹ç‚¹1
- å…·ä½“ä¿®æ”¹ç‚¹2

Benefits:
- æ”¹è¿›å¸¦æ¥çš„å¥½å¤„1
- æ”¹è¿›å¸¦æ¥çš„å¥½å¤„2
```

**ç±»å‹ (type)**:

- `feat`: æ–°åŠŸèƒ½
- `fix`: ä¿®å¤ bug
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼è°ƒæ•´
- `refactor`: é‡æ„
- `perf`: æ€§èƒ½ä¼˜åŒ–
- `test`: æµ‹è¯•ç›¸å…³
- `build`: æ„å»ºç›¸å…³
- `chore`: å…¶ä»–æ‚é¡¹

**è¦æ±‚**:

- å…¨éƒ¨ä½¿ç”¨è‹±æ–‡
- ç¬¬ä¸€è¡Œä¸è¶…è¿‡ 50 ä¸ªå­—ç¬¦ï¼Œæ— æ ‡ç‚¹ç¬¦å·
- ç¬¬äºŒè¡Œç©ºè¡Œ
- ç¬¬ä¸‰è¡Œå¼€å§‹ï¼šChanges å’Œ Benefits éƒ¨åˆ†
- ä¸ä½¿ç”¨ "Generated by" å’Œ "Co-authored-by" å­—æ®µ

### ä»£ç è´¨é‡è¦æ±‚

- **ç±»å‹æ³¨è§£**: TypeScript ä¸¥æ ¼æ¨¡å¼ï¼ŒPython ä½¿ç”¨ type hints
- **é”™è¯¯å¤„ç†**: ä½¿ç”¨ try-catch/try-except æ•è·å¼‚å¸¸
- **æ—¥å¿—è®°å½•**: ä½¿ç”¨ logging æ¨¡å—ï¼Œé¿å… console.log/print
- **æµ‹è¯•è¦†ç›–**: æ–°åŠŸèƒ½å¿…é¡»åŒ…å«å•å…ƒæµ‹è¯•

## 7. å…³é”®æŠ€æœ¯æ¨¡å¼

### SSE æµå¼é€šä¿¡

å‰ç«¯é€šè¿‡ EventSource è®¢é˜…åç«¯æŠ˜å è¿›åº¦ï¼š

```typescript
// StepEvent ç»“æ„
{
  eventId: string;
  taskId: string;
  stage: 'QUEUED' | 'MSA' | 'MODEL' | 'RELAX' | 'QA' | 'DONE' | 'ERROR';
  status: 'queued' | 'running' | 'partial' | 'complete' | 'failed';
  progress: number; // 0-100
  message: string;
  artifacts?: StructureArtifact[];
}
```

### Mol\* åŠ¨æ€åŠ è½½

é¿å… SSR é—®é¢˜çš„æ¨¡å—åŠ è½½æ¨¡å¼ï¼š

```typescript
// åŠ¨æ€å¯¼å…¥ Mol* æ¨¡å—
const molstar = await import("molstar/lib/mol-plugin-ui");
```

### Zustand çŠ¶æ€æŒä¹…åŒ–

```typescript
persist(
  (set, get) => ({ ... }),
  { name: 'chatfold-storage' }
)
```

## 8. æ–‡æ¡£å¯¼èˆª

### æ–°æˆå‘˜å…¥é—¨

1. **å¿«é€Ÿå¼€å§‹**
   - é˜…è¯»æœ¬æ–‡æ¡£äº†è§£é¡¹ç›®æ¦‚è§ˆ
   - è¿è¡Œå¼€å‘å‘½ä»¤å¯åŠ¨æœåŠ¡

2. **äº†è§£é¡¹ç›®**
   - [docs/features/](./docs/features/) - åŠŸèƒ½å®ç°æ–‡æ¡£
   - [docs/features/molstar-usage-guide.md](./docs/features/molstar-usage-guide.md) - Mol\* ä½¿ç”¨æŒ‡å—

3. **å¼€å§‹å¼€å‘**
   - éµå¾ªå¼€å‘è§„èŒƒä¸­çš„ Commit è§„èŒƒ
   - å‚è€ƒ `web/src/components/` äº†è§£ç»„ä»¶ç»“æ„

## 9. ä¸šåŠ¡è§„èŒƒ

- ç¡®ä¿è›‹ç™½è´¨åºåˆ—éªŒè¯ï¼ˆ10-5000 ä¸ªæ°¨åŸºé…¸ï¼‰
- ç»“æ„æ–‡ä»¶ä½¿ç”¨æ ‡å‡† PDB æ ¼å¼
- API å¯†é’¥å’Œæ•æ„Ÿä¿¡æ¯ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œä¸æäº¤åˆ°ä»£ç åº“

## 10. å¸¸ç”¨é“¾æ¥

- **å‰ç«¯ç•Œé¢**: <http://localhost:3000> (æœ¬åœ°å¼€å‘)
- **åç«¯ API**: <http://localhost:8000/docs> (FastAPI æ–‡æ¡£)
- **å®Œæ•´æ–‡æ¡£**: [docs/README.md](./docs/README.md)

---

**ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2025-12-26
**ç»´æŠ¤è€…**: ChatFold å¼€å‘å›¢é˜Ÿ
