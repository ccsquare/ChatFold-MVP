# CLAUDE.md - ChatFold Project Guidance

This file provides guidance to Claude Code when working with this repository.

## Product Overview

ChatFold is a ChatGPT-style protein folding workbench with real-time streaming progress and 3D structure visualization.

### Input

- FASTA format protein sequences (10-5000 amino acids)
- PDB structure files (drag & drop upload)
- Natural language chat instructions

### Output

- 3D protein structure visualization (Mol*)
- Real-time folding progress (SSE streaming)
- Structure quality metrics (pLDDT, PAE)
- Downloadable PDB structure files

## Project Structure

```
ChatFold-MVP/
├── web/                 # Next.js 14 frontend
│   ├── src/
│   │   ├── app/         # App Router pages
│   │   ├── components/  # React components
│   │   ├── hooks/       # Custom hooks
│   │   └── lib/         # Utils and Zustand store
│   └── tests/fixtures/  # Test data (FASTA, PDB)
│
├── backend/             # FastAPI backend
│   └── app/
│       ├── api/v1/      # API endpoints
│       ├── services/    # Business logic
│       └── models/      # Pydantic schemas
│
└── docs/                # Documentation
```

## Tech Stack

**Frontend**: Next.js 14, React 18, TypeScript, TailwindCSS, Zustand, Mol* 4.5.0, shadcn/ui

**Backend**: Python 3.10+, FastAPI, Pydantic, Uvicorn

## Quick Commands

```bash
# Frontend (port 3000)
cd web && npm install && npm run dev

# Backend (port 8000)
cd backend && pip install -r requirements.txt
uvicorn app.main:app --reload --port 8000
```

## Key Components

- **LayoutShell.tsx**: Three-column layout (sidebar | canvas | console)
- **MolstarViewer.tsx**: 3D structure viewer with dynamic loading
- **store.ts**: Zustand global state with persistence
- **useFoldingTask.ts**: SSE streaming hook

## API Endpoints (v1)

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/api/v1/health` | GET | Health check |
| `/api/v1/conversations` | POST/GET | Conversation CRUD |
| `/api/v1/tasks` | POST/GET | Task management |
| `/api/v1/tasks/{id}/stream` | GET | SSE folding progress |
| `/api/v1/structures/{id}` | GET | Download PDB file |

## SSE Event Structure

```typescript
{
  eventId: string;
  taskId: string;
  stage: 'QUEUED' | 'MSA' | 'MODEL' | 'RELAX' | 'QA' | 'DONE' | 'ERROR';
  status: 'queued' | 'running' | 'partial' | 'complete' | 'failed';
  progress: number; // 0-100
  message: string;
  artifacts?: StructureArtifact[];
}
```

## Commit Message Format

```
type: subject (max 50 chars, no punctuation)

Changes:
- Specific change 1
- Specific change 2

Benefits:
- Improvement 1
- Improvement 2
```

Types: feat, fix, docs, style, refactor, perf, test, build, chore

**Requirements**: English only, no "Generated by" or "Co-authored-by" fields.


## Test Tips

Please refer to `start.sh` to start the frontend and backend of ChatFold. If major changes are applied to the codebase, please restart the frontend and backend to visualize the latest update.